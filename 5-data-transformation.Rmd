---
title: "5. Data transformation"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
```

```{r, include=FALSE}
library(nycflights13)
``` 

### 5.2.4 Exercises

1. Find all flights that

Had an arrival delay of two or more hours

```{r}
filter(flights, arr_delay >= 120)
```

Flew to Houston (`IAH` or `HOU`)

```{r}
filter(flights, dest %in% c("IAH", "HOU"))
```

Were operated by United, American, or Delta

```{r}
filter(flights, carrier %in% c("UA", "AA", "DL"))
```

Departed in summer (July, August, and September)

```{r}
filter(flights, month %in% c(7, 8, 9))
```

Arrived more than two hours late, but didnâ€™t leave late

```{r}
filter(flights, arr_delay >= 120 & dep_delay <= 0)
```

Were delayed by at least an hour, but made up over 30 minutes in flight

```{r}
filter(flights, dep_delay >= 60  & dep_delay - arr_delay > 30)
```

Departed between midnight and 6am (inclusive)

```{r}
filter(flights, dep_time <= 600 | dep_time == 2400)
```

2. Another useful dplyr filtering helper is `between()`. What does it do? Can you use it to simplify the code needed to answer the previous challenges?

It is a shortcut for finding values that fall in a specified range:

```{r}
filter(flights, between(month, 7, 9))
```

3. How many flights have a missing `dep_time`? What other variables are missing? What might these rows represent?

```{r}
filter(flights, is.na(dep_time))
```

8,255 flights. `arr_time` is also missing. These flights were most likely cancelled.

4. Why is `NA ^ 0` not missing? Why is `NA | TRUE` not missing? Why is `FALSE & NA` not missing? Can you figure out the general rule? (`NA * 0` is a tricky counterexample!)

See Jeffrey Arnold's [answer key](https://jrnold.github.io/e4qf/data-transformation.html#exercises-5).

### 5.3.1 Exercises

1. How could you use `arrange()` to sort all missing values to the start? (Hint: use `is.na()`).

```{r}
arrange(flights, desc(is.na(dep_time)))
```

2. Sort `flights` to find the most delayed flights. Find the flights that left earliest.

```{r}
arrange(flights, desc(dep_delay))
```

```{r}
arrange(flights, dep_delay)
```

3. Sort `flights` to find the fastest flights.

```{r}
arrange(flights, arr_delay)
```

4. Which flights travelled the longest? Which travelled the shortest?

```{r}
arrange(flights, desc(distance))
```

```{r}
arrange(flights, distance)
```

### 5.4.1 Exercises

1. Brainstorm as many ways as possible to select `dep_time`, `dep_delay`, `arr_time`, and `arr_delay` from `flights`.

```{r}
select(flights, dep_time, dep_delay, arr_time, arr_delay)

select(flights, starts_with("dep"), starts_with("arr"))
```

2. What happens if you include the name of a variable multiple times in a `select()` call?

It will only print once.

```{r}
select(flights, dep_time, dep_time)
```

3. What does the `one_of()` function do? Why might it be helpful in conjunction with this vector?

```{r}
vars <- c("year", "month", "day", "dep_delay", "arr_delay")
```

The `one_of()` function allows you to use variables stored in a character vector:

```{r}
select(flights, one_of(vars))
```

It helps simplify code.

4. Does the result of running the following code surprise you? How do the select helpers deal with case by default? How can you change that default?

```{r}
select(flights, contains("TIME"))
```

Select helpers are not case sensitive by default. To change the default, use `ignore.case = FALSE`.
